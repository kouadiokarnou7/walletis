{% extends "layout.html" %}
{% block title %} Walletis - Transactions {% endblock %}

{% block content %}
<style>
    .transaction-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6; }
    .transaction-item:last-child { border-bottom: none; }
    .amount-credit { color: #10b981; font-weight: 600; }
    .amount-debit { color: #ef4444; font-weight: 600; }
    .btn-back { display: inline-flex; align-items: center; padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; text-decoration: none; color: #374151; margin-bottom: 1rem; cursor: pointer;}
</style>

<div class="container mx-auto py-8 max-w-4xl">
    <!-- En-tête avec retour -->
    <div class="mb-6">
        <a href="/comptes" class="btn-back">← Retour aux comptes</a>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-end mb-6 border-b pb-4">
            <div>
                <p class="text-gray-500 text-sm">Historique pour</p>
                <h1 id="accountNameDisplay" class="text-2xl font-bold text-gray-800">Chargement...</h1>
            </div>
            <div class="text-right">
                <p class="text-gray-500 text-sm">Solde actuel</p>
                <p id="accountBalanceDisplay" class="text-xl font-bold text-gray-900">...</p>
            </div>
        </div>

        <!-- Liste des transactions -->
        <div id="transactionsList">
            <!-- Injecté par JS -->
        </div>
    </div>
</div>

<script>
    // --- Simulation Backend Transactions ---
    const allTransactions = [
        { id: 1, accountId: 1, desc: "Achat Supermarché", amount: -45.50, date: "2023-10-25" },
        { id: 2, accountId: 1, desc: "Salaire Octobre", amount: 2400.00, date: "2023-10-24" },
        { id: 3, accountId: 1, desc: "Abonnement Netflix", amount: -15.99, date: "2023-10-20" },
        { id: 4, accountId: 2, desc: "Virement Epargne", amount: 200.00, date: "2023-10-18" },
    ];

    // Récupérer l'ID depuis l'URL (ex: ?id=1)
    const urlParams = new URLSearchParams(window.location.search);
    const currentAccountId = parseInt(urlParams.get('id'));

    // Données comptes (reprise pour l'exemple)
    const accountsDB = [
        { id: 1, name: "Compte Courant", balance: 1250.50 },
        { id: 2, name: "Livret A", balance: 5000.00 }
    ];

    function initTransactions() {
        const account = accountsDB.find(a => a.id === currentAccountId);
        
        if(!account) {
            document.getElementById('accountNameDisplay').innerText = "Compte introuvable";
            return;
        }

        // Afficher infos compte
        document.getElementById('accountNameDisplay').innerText = account.name;
        document.getElementById('accountBalanceDisplay').innerText = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(account.balance);

        // Filtrer et afficher transactions
        const list = document.getElementById('transactionsList');
        list.innerHTML = "";
        
        const accTransactions = allTransactions.filter(t => t.accountId === currentAccountId);

        if(accTransactions.length === 0) {
            list.innerHTML = "<p class='text-center text-gray-400 py-4'>Aucune transaction récente.</p>";
        } else {
            accTransactions.forEach(t => {
                const isCredit = t.amount >= 0;
                const sign = isCredit ? '+' : '';
                const colorClass = isCredit ? 'amount-credit' : 'amount-debit';
                
                const row = document.createElement('div');
                row.className = 'transaction-item';
                row.innerHTML = `
                    <div>
                        <div class="font-medium text-gray-800">${t.desc}</div>
                        <div class="text-xs text-gray-500">${t.date}</div>
                    </div>
                    <div class="${colorClass}">
                        ${sign}${t.amount.toFixed(2)} €
                    </div>
                `;
                list.appendChild(row);
            });
        }
    }

    // Lancer au chargement
    initTransactions();
</script>
{% endblock %}